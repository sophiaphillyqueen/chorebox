# configure: Configures -chorebox-
# Copyright (C) 2014  Sophia Elizabeth Shapira

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ########################

# First, I initialize the $origidir variable to the source-code
# directory.
origidir="$(dirname "${0}")"
abs_origidir="$(cd "${origidir}" && pwd)"
# .. and I identify the for-local C compiler and error flags
sh "${origidir}/ident-local-cc.sh" "${@}" > temporary--c-compiler.txt
sh "${origidir}/set-extra-cc-flags.sh" "${@}"


say_yes=yes
say_no=no
try_backup_on=yes
native_conf_here=yes

# Let us try to compile the C-based version here:
sh "${origidir}/build-temp-from-c.sh" temporary--chorebox-cf \
"${origidir}/chorebox-cf-src/main.c" || try_backup_on=no


if [ $try_backup_on = $say_no ]; then
  native_conf_here=no
fi
#if [ -f "robust.flag" ]; then
#  try_backup_on=yes
#fi
#if [ -f "robust-configure.flag" ]; then
#  try_backup_on=yes
#fi
if [ $try_backup_on = $say_no ]; then
  exit 3
fi

exec ./temporary--chorebox-configure Makefile.pre \
  --srcdir="${origidir}" \
"${@}"
exit


